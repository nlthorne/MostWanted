var dataObject = {
	"272822514" : {
	  "firstName": "Billy",
	  "lastName": "Bob",
	  "gender": "male",
	  "dob": "1/18/1949",
	  "height": 71,
	  "weight": 175,
	  "eyeColor": "brown",
	  "occupation": "programmer",
	  "parents": [],
	  "currentSpouse": 401222887
	},
	"401222887" : {
	  "firstName": "Uma",
	  "lastName": "Bob",
	  "gender": "female",
	  "dob": "4/1/1947",
	  "height": 65,
	  "weight": 162,
	  "eyeColor": "brown",
	  "occupation": "assistant",
	  "parents": [],
	  "currentSpouse": 272822514
	},
	"409574486" : {
	  "firstName": "Michael",
	  "lastName": "Walkens",
	  "gender": "male",
	  "dob": "5/9/1951",
	  "height": 76,
	  "weight": 250,
	  "eyeColor": "brown",
	  "occupation": "landscaper",
	  "parents": [],
	  "currentSpouse": 260451248
	},
	"260451248" : {
	  "firstName": "Jon",
	  "lastName": "Walkens",
	  "gender": "male",
	  "dob": "9/6/1945",
	  "height": 62,
	  "weight": 115,
	  "eyeColor": "brown",
	  "occupation": "assistant",
	  "parents": [],
	  "currentSpouse": 409574486
	},
	"629807187" : {
	  "firstName": "Jack",
	  "lastName": "Pafoy",
	  "gender": "male",
	  "dob": "3/16/1938",
	  "height": 70,
	  "weight": 207,
	  "eyeColor": "black",
	  "occupation": "nurse",
	  "parents": [],
	  "currentSpouse": 464142841
	},
	"464142841" : {
	  "firstName": "Jen",
	  "lastName": "Pafoy",
	  "gender": "female",
	  "dob": "4/10/1940",
	  "height": 72,
	  "weight": 256,
	  "eyeColor": "black",
	  "occupation": "student",
	  "parents": [],
	  "currentSpouse": 629807187
	},
	"982411429" : {
	  "firstName": "Mister",
	  "lastName": "Potatoo",
	  "gender": "male",
	  "dob": "12/18/1952",
	  "height": 66,
	  "weight": 170,
	  "eyeColor": "hazel",
	  "occupation": "architect",
	  "parents": [],
	  "currentSpouse": 595767575
	},
	"595767575" : {
	  "firstName": "Missuz",
	  "lastName": "Potatoo",
	  "gender": "female",
	  "dob": "10/28/1948",
	  "height": 59,
	  "weight": 137,
	  "eyeColor": "blue",
	  "occupation": "architect",
	  "parents": [],
	  "currentSpouse": 982411429
	},
	"693243224" : {
	  "firstName": "Joy",
	  "lastName": "Madden",
	  "gender": "female",
	  "dob": "4/20/1939",
	  "height": 69,
	  "weight": 199,
	  "eyeColor": "hazel",
	  "occupation": "doctor",
	  "parents": [],
	  "currentSpouse": 693243224
	},
	"888201200" : {
	  "firstName": "Mader",
	  "lastName": "Madden",
	  "gender": "male",
	  "dob": "5/6/1937",
	  "height": 76,
	  "weight": 205,
	  "eyeColor": "black",
	  "occupation": "landscaper",
	  "parents": [],
	  "currentSpouse": 888201200
	},
	"878013758" : {
	  "firstName": "Jill",
	  "lastName": "Pafoy",
	  "gender": "female",
	  "dob": "2/8/1972",
	  "height": 74,
	  "weight": 118,
	  "eyeColor": "brown",
	  "occupation": "programmer",
	  "parents": [401222887,272822514],
	  "currentSpouse": 294874671
	},
	"951747547" : {
	  "firstName": "Ralph",
	  "lastName": "Bob",
	  "gender": "male",
	  "dob": "12/23/1969",
	  "height": 66,
	  "weight": 179,
	  "eyeColor": "blue",
	  "occupation": "nurse",
	  "parents": [401222887,272822514],
	  "currentSpouse": 159819275
	},
	"159819275" : {
	  "firstName": "Jasmine",
	  "lastName": "Bob",
	  "gender": "female",
	  "dob": "12/18/1969",
	  "height": 58,
	  "weight": 156,
	  "eyeColor": "blue",
	  "occupation": "assistant",
	  "parents": [409574486,260451248],
	  "currentSpouse": 951747547
	},
	"348457184" : {
	  "firstName": "Annie",
	  "lastName": "Pafoy",
	  "gender": "female",
	  "dob": "11/4/1970",
	  "height": 62,
	  "weight": 235,
	  "eyeColor": "hazel",
	  "occupation": "landscaper",
	  "parents": [629807187,464142841],
	  "currentSpouse": null
	},
	"294874671" : {
	  "firstName": "Dave",
	  "lastName": "Pafoy",
	  "gender": "male",
	  "dob": "8/5/1967",
	  "height": 61,
	  "weight": 112,
	  "eyeColor": "green",
	  "occupation": "doctor",
	  "parents": [629807187,464142841],
	  "currentSpouse": 878013758
	},
	"931247228" : {
	  "firstName": "Amii",
	  "lastName": "Pafoy",
	  "gender": "female",
	  "dob": "3/13/1963",
	  "height": 74,
	  "weight": 184,
	  "eyeColor": "brown",
	  "occupation": "landscaper",
	  "parents": [629807187,464142841],
	  "currentSpouse": null
	},
	"822843554" : {
	  "firstName": "Regina",
	  "lastName": "Madden",
	  "gender": "female",
	  "dob": "7/26/1959",
	  "height": 71,
	  "weight": 249,
	  "eyeColor": "brown",
	  "occupation": "nurse",
	  "parents": [693243224, 888201200],
	  "currentSpouse": null
	},
	"819168108" : {
	  "firstName": "Hana",
	  "lastName": "Madden",
	  "gender": "female",
	  "dob": "10/7/1953",
	  "height": 70,
	  "weight": 187,
	  "eyeColor": "brown",
	  "occupation": "politician",
	  "parents": [693243224, 888201200],
	  "currentSpouse": null
	},
	"969837479" : {
	  "firstName": "Eloise",
	  "lastName": "Madden",
	  "gender": "female",
	  "dob": "12/11/1961",
	  "height": 63,
	  "weight": 241,
	  "eyeColor": "brown",
	  "occupation": "assistant",
	  "parents": [693243224, 888201200],
	  "currentSpouse": null
	},
	"313207561" : {
	  "firstName": "Mattias",
	  "lastName": "Madden",
	  "gender": "male",
	  "dob": "2/19/1966",
	  "height": 70,
	  "weight": 110,
	  "eyeColor": "blue",
	  "occupation": "assistant",
	  "parents": [693243224, 888201200],
	  "currentSpouse": 313997561
	},
	"313997561" : {
	  "firstName": "Ellen",
	  "lastName": "Madden",
	  "gender": "female",
	  "dob": "2/19/1970",
	  "height": 67,
	  "weight": 100,
	  "eyeColor": "blue",
	  "occupation": "doctor",
	  "parents": [],
	  "currentSpouse": 313207561
	},
	"313998000" : {
	  "firstName": "Joey",
	  "lastName": "Madden",
	  "gender": "female",
	  "dob": "2/02/1987",
	  "height": 67,
	  "weight": 100,
	  "eyeColor": "blue",
	  "occupation": "doctor",
	  "parents": [313207561,313997561],
	  "currentSpouse": null
	}
};


var people = [];
var personList = [];
changeDataObject();
startSearch();


function startSearch(){
	alert("You are entering a classified site.\r\n codeName : Most Wanted \r\n Site is for authorized personnel only!")
	var result = prompt("What would you like to do? Choose one of following to search:\r\n 'name' to search by first and last name.\r\n'descendants' to see all of a person's descendants.\r\n'next of kin' to see a person's next of kin.\r\n'traits' to search by up to 5 criteria.\r\n 'family' to see a person's immediate family.\r\n'exit' to end.");
	if(result != "name" && result != 'descendants' && result != 'next of kin' && result != 'traits' && result != 'family' && result != 'exit'){
		alert("invalid entry. try again.");
		startSearch();
	}else{
		userInterface(result);
	}
	startSearch();
}

function userInterface(result){

  switch(result){
		case "name":
			var person = promptForName();
			if(person != undefined){
				displayPerson(person, "Match: \r\n");
			}
			break;
		case "descendants":
			var person = promptForName();
			personList = [];
			getDescendants(person);
			if(personList.length != 0){
				displayListOfPersons(personList, "descendants: ");
			}
			break;
		case "family":
  		personList = [];
  		var person = promptForName();
  		getImmediateFamily(person);
			if(personList.length != 0){
  			displayListOfPersons(personList, "Immediate family: ");
			}
  		break;
		case "next of kin":
	  	var person = promptForName();
	  	personList = [];
	  	var nextKin = getNextOfKin(person);
			if(nextKin != undefined){
	  		displayPerson(nextKin, "Next of kin:\r\n");
			}
	  	break;
		case "traits":
			personList = [];
	    splitUserInput(prompt("Search up to 5 traits: separate each trait with a comma.\r\nTypes of terms you can choose from:\r\nage (only in the format #)\r\nage range (only in the format #-#)\r\nheight (only in the format #\'#\")\r\nweight (only in the format #lbs)\r\n occupation (as a single word)\r\neye color (as a single word)"));
			if(personList.length != 0){
				displayListOfPersons(personList, "Trait search: ");
			}else{
				alert("No one was found with that search criteria.");
			}
	  	break;
		case "exit":
			alert("Logout Confirmed.");
			exit();
			return;
	}
}

function getTraitInput(typeSearch){
	if(typeSearch == "eye color"){
		var input = prompt("Enter eye color:");
		searchByTrait("eyeColor", input);
	}else if(typeSearch == "height"){
		var heightFT = parseInt(prompt("Enter feet:")) * 12;
		var heightFull = parseInt(prompt("Enter inches:")) + heightFT;
		searchByTrait("height", heightFull)
	}else if(typeSearch == "weight"){
		var input = prompt("Enter weight:");
		searchByTrait(typeSearch, input);
	}else if(typeSearch == "age"){
		var input = prompt("Enter age:");
		searchByTrait(typeSearch, input);
	}else if(typeSearch == "occupation"){
		var input = prompt("Enter occupation:")
		searchByTrait(typeSearch, input);
	}else if(typeSearch == "gender"){
		var input = prompt("Type 'male' or 'female':");
		if(input != "male" && input != 'female'){
			alert("Selection must be 'male' or 'female'. Try again.");
			getTraitInput("gender");
		} else{
		searchByTrait(typeSearch, input);
	}
	}
}

function errorCheck(check){
	try{
  			if(check == undefined || check.length == 0)
  				throw(error);
  		}catch(error){
  			console.log(error.message);
  			console.log('No Data Found!');
  			alert("No Data Found.");
  		}
}

function promptForName(){
	var name = getPersonByName(prompt("Enter first name: "),prompt("Enter last name: "));
	if(name != undefined){
		return name;
	}else{
		alert("No matches for that name.");
		return undefined;
	}
}

function getPersonByName(firstNameSearch, lastNameSearch){
	for (var i = 0; i < people.length; i++) {
		if(people[i].firstName.toLowerCase() == firstNameSearch.toLowerCase() && people[i].lastName.toLowerCase() == lastNameSearch.toLowerCase()){
			return people[i];
		}
	}
	return undefined;
}
function displayListOfPersons(listOfPeople, strType){
  		for(var i = 0; i < listOfPeople.length; i++){
  			displayPerson(listOfPeople[i], (strType + (i + 1) + ":\r\n"))
  		}
}
function displayPerson(person, displayString){
  		var buildPerson = "" + displayString;
  		for(var item in person){
  			if(item == "parents"){
  				for (var i = 0; i < person[item].length; i++){
  					buildPerson = buildPerson + item + " " + (i + 1) + ": " + dataObject[person[item][i]].firstName + " " + dataObject[person[item][i]].lastName + "\r\n";
  				}
  			}else if(item == "height"){
  				buildPerson = buildPerson + item + ": " + Math.floor(person[item] / 12) + "'" + (person[item] % 12) + "\"" + "\r\n";
  			}else if(item == "currentSpouse"){
  				if(person[item] != null){
  					buildPerson = buildPerson + "Spouse: " + dataObject[person[item]].firstName + " " + dataObject[person[item]].lastName  + "\r\n";
  				}
  			}else if(item == "weight"){
  				buildPerson = buildPerson + item + ": " + person[item] + " lbs." + "\r\n";
  			}else{
  				buildPerson = buildPerson + item + ": " + person[item] + "\r\n";
  			}
  		}
  		alert(buildPerson);
  	}

function Person(id, firstName, lastName, gender, dob, height, weight, eyeColor, occupation, parents, currentSpouse){
	this.id = id;
	this.firstName = firstName;
	this.lastName = lastName;
	this.gender = gender;
	this.dob = dob;
	this.height = height;
	this.weight = weight;
	this.eyeColor = eyeColor;
	this.occupation = occupation;
	this.parents = parents;
	this.currentSpouse = currentSpouse;
}

function changeDataObject(){
	var index = 0;
	for(var key in dataObject){
		people[index] = new Person(key, dataObject[key].firstName, dataObject[key].lastName, dataObject[key].gender, dataObject[key].dob, dataObject[key].height, dataObject[key].weight, dataObject[key].eyeColor, dataObject[key].occupation, dataObject[key].parents, dataObject[key].currentSpouse);
		index++;
	}
}
function splitUserInput(userInput){
	var traits = [];
	var matches = [];
	var check = '';
	var weight = '';
	var height = '';
	var ageRangeLow = '';
	var ageRangeHigh = '';
	var multiA = ''; 
	var multiB = '';
	var multiC = '';

	matches = people;

	var noSpacesInput = userInput.replace(/\s+/g, '');
	traits = noSpacesInput.split(',');

	for (var i = 0; i < traits.length; i++) {
		if(traits[i].indexOf('lbs') >= 0){
			weight = traits[i].replace('lbs', '');
		} else if(traits[i].indexOf('\'') >= 0){
			check = traits[i].replace('\"', '');
			check = check.split('\'');
			height = Number(check[0] * 12) + Number(check[1]);
		} else if(traits[i].indexOf('-') >= 0){
			check = traits[i].split('-');
			ageRangeLow = check[0];
			ageRangeHigh = check[1];
		} else if(multiA == ''){
			multiA = traits[i];
		} else if(multiB == ''){
			multiB = traits[i];
		} else if(multiC == ''){
			multiC = traits[i];
		}
	}
	if(userInput != ''){
		searchFiveTraits(weight, height, ageRangeLow, ageRangeHigh, multiA, multiB, multiC);
	}else{
		alert("Returning to main menu due to invalid entry.");
	}
}

function searchFiveTraits(weight, height, ageRangeLow, ageRangeHigh, multiA, multiB, multiC){
	var matches = people;
	if(weight != ''){
		matches = matches.filter(function(person){if(person.weight == weight){return true;}else{return false;}});
	}
	if(height != ''){
		matches = matches.filter(function(person){if(person.height == height){return true;}else{return false;}});
	}
	if(ageRangeLow != ''){
		matches = matches.filter(function(person){if(getAge(person.dob) >= ageRangeLow && getAge(person.dob) <= ageRangeHigh){return true;}else{return false;}});
	}
	if(multiA != ''){
		matches = matches.filter(function(person){if(multiA == getAge(person.dob) || multiA == person.eyeColor || multiA == person.occupation){return true;}else{return false;}});
	}
	if(multiB != ''){
		matches = matches.filter(function(person){if(multiB == getAge(person.dob) || multiB == person.eyeColor || multiB == person.occupation){return true;}else{return false;}});
	}
	if(multiC != ''){
		matches = matches.filter(function(person){if(multiC == getAge(person.dob) || multiC == person.eyeColor || multiC == person.occupation){return true;}else{return false;}});
	}
		personList = matches;
}


function getNextOfKin(person){
	if(person != undefined){
	getSpouse(person);
	if(personList.length != 0)
		return personList[0];
	getChildren(person);
	if(personList.length != 0){
		return getOldestFromArray(personList);
	}
	getParents(person.parents);
	if(personList.length != 0){
		return getOldestFromArray(personList);
	}
	getSiblings(person);
	if(personList.length != 0){
		return getOldestFromArray(personList);
	}
	getGrandchildren(person);
	if(personList.length != 0){
		return getOldestFromArray(personList);
	}
	getGrandParents(person);
	if(personList.length != 0){
		return getOldestFromArray(personList);
	}
	getNieceNephews(person);
	if(personList.length != 0){
		return getOldestFromArray(personList);
	}
	getAuntUncles(person);
	if(personList.length != 0){
		return getOldestFromArray(personList);
	}
	getGreatGrandChildren(person);
	if(personList.length != 0){
		return getOldestFromArray(personList);
	}
	getGreatGrandParents(person);
	if(personList.length != 0){
		return getOldestFromArray(personList);
	}
}
	return undefined;
}

function getAuntUncles(person){
	var parents = [];
	getParents(person);
	parents = personList;
	personList = [];
	for (var i = 0; i < parents.length; i++) {
		getSiblings(parents[i]);
	}
}

function getNieceNephews(person){
	var siblings = [];
	getSiblings(person);
	siblings = personList;
	personList = [];
	for (var i = 0; i < siblings.length; i++) {
		getSiblings(siblings[i]);
	}
}

function getGrandParents(person){
	var parents = [];
	getParents(person);
	parents = personList;
	personList = [];
	for (var i = 0; i < parents.length; i++) {
		getParents(parents[i]);
	}
}

function getGreatGrandParents(person){
	getGrandParents(person);
	var grandParents = personList;
	personList = [];
	for (var i = 0; i < grandParents.length; i++) {
		getParents(grandParents[i]);
	}
}

function getGreatGrandChildren(person){
	getGrandChildren(person);
	var grandKids = personList;
	personList = [];
	for (var i = 0; i < grandKids.length; i++) {
		getChildren(grandkids[i]);
	}
}

function getGrandChildren(person){
	var children = [];
	getChildren(person);
	children = personList;
	personList = [];
	for (var i = 0; i < children.length; i++) {
		getChildren(children[i]);
	}
}

function getAge(birthDate) {

    	var today = new Date();
    	var nowyear = today.getFullYear();
    	var nowmonth = today.getMonth();
    	var nowday = today.getDate();

    	var currentDoB = birthDate.split("/");
    	var birthyear = currentDoB[2];
    	var birthmonth = currentDoB[0];
    	var birthday = currentDoB[1];

    	var age = nowyear - birthyear;
    	var age_month = nowmonth - birthmonth;
    	var age_day = nowday - birthday;

    	if(age_month < 0 || (age_month == 0 && age_day < 0)) {
            age = age -1;
        }
        age = parseInt(age);
    	return age;
	}
function getOldestFromArray(listOfPeople){
  		var OldestPerson = undefined;
  		for (var i = 0; i < listOfPeople.length; i++) {
  			var currentAge = getAge(listOfPeople[i].dob);
  			if(OldestPerson != undefined){
  				var previousAge = getAge(listOfPeople[i].dob);
  			}
  			if(OldestPerson == undefined){
  				OldestPerson = listOfPeople[i];
  			} else if(currentAge < previousAge){
  				OldestPerson = listOfPeople[i];
  			}
  		}
  		return OldestPerson;
  	}
function getDescendants(person){
	if(person != undefined){
	for (var i = 0; i < people.length; i++) {
		if(people[i].parents.length != 0){
			if(people[i].parents[0] == person.id || people[i].parents[1] == person.id)
				if(!containsObject(people[i], personList)){
					personList.push(people[i]);
					getDescendants(people[i]);
				}
		}
	}
}else{
	return undefined;
}
}

function containsObject(obj, list) {
    for (var i = 0; i < list.length; i++) {
        if (list[i] === obj) {
            return true;
        }
    }
    return false;
}

function getImmediateFamily(person){
	if(person != undefined){
		getSpouse(person);
		getParents(person.parents);
		getSiblings(person);
		getChildren(person);
	}
	else{
		return undefined;
	}
}
function getParents(listPerson){
		if(listPerson.length != 0){
  		for (var i = 0; i < listPerson.length; i++) {
				for (var j = 0; j < people.length; j++) {
					if(people[j].id == listPerson[i]){
						personList.push(people[j]);
					}
				}
  		}
		}
}
function getPersonByID(idSearch){
	for (var i = 0; i < people.length; i++) {
		if(people[i].id == idSearch)
		return people[i];
	}
	return undefined;
}
function getSiblings(person){
	if(person.parents.length != 0){
  		for (var i = 0; i < people.length; i++) {
  			if(people[i].parents[0] == person.parents[0] || people[i].parents[1] == person.parents[1] ||
  				people[i].parents[1] == person.parents[0] || people[i].parents[0] == person.parents[1])
  				if(people[i] != person)
  					personList.push(people[i]);
  		}
		}
}
function getSpouse(person){
	searchByTrait("id", person.currentSpouse);
}
function getChildren(person){
	for (var i = 0; i < people.length; i++) {
		if(people[i].parents.length != 0){
			if(people[i].parents[0] == person.id || people[i].parents[1] == person.id)
				if(!containsObject(people[i], personList)){
					personList.push(people[i]);
				}
		}
	}
}
function searchByTrait(traitType, input){
	if(traitType == 'age'){
		for (var i = 0; i < people.length; i++) {
			if(getAge(people[i].dob) == input)
				personList.push(people[i]);
		}
	} else{
		personList = people.filter( function(person){
			if(person[traitType] == input) {return true;}
			else {return false;}
		});
	}
}
